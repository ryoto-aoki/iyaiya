<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>イヤイヤ期子育てシミュレーションゲーム〜りーちゃん編〜</title>
    <style>
        :root {
            --scene-aspect-ratio: 4 / 3; /* グローバルなアスペクト比設定 */
        }
        
        /* シーン画像のリセットスタイル */
        .scene-image,
        .scene-image img {
            aspect-ratio: var(--scene-aspect-ratio) !important;
        }
        
        body {
            font-family: 'Meiryo', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff0f5;
        }
        .screen {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        #title-screen {
            padding: 50px 20px;
            background-color: #fff0f5;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        #title-screen h1 {
            font-size: 2.5em;
            color: #ff6699;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .title-image {
            width: 100%;
            max-width: 500px;
            height: auto;
            margin: 0 auto 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            background-color: #ffebf3;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 5px solid #fff;
            aspect-ratio: 4 / 3; /* 4:3比率に変更 */
        }
        .title-image img {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover; /* 画像がフレームを埋めるように表示 */
        }
        .start-btn {
            padding: 15px 50px;
            font-size: 1.5em;
            background-color: #ff9900;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .start-btn:hover {
            background-color: #ffaa33;
            transform: scale(1.05);
        }
        #rules-screen {
            padding: 30px 20px;
        }
        .rules-container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .rules-container h2 {
            color: #ff6699;
            margin-bottom: 20px;
        }
        .rules-content {
            text-align: left;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .ree-chan {
            color: #ff6699;
            font-weight: bold;
        }
        .highlight {
            background-color: #ffffaa;
            padding: 0 3px;
        }
        .rules-ok-btn {
            padding: 10px 40px;
            font-size: 1.2em;
            background-color: #66cc66;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .rules-ok-btn:hover {
            background-color: #77dd77;
            transform: scale(1.05);
        }
        .game-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .meter {
            width: 30%;
            background-color: #eee;
            border-radius: 5px;
            overflow: hidden;
        }
        .meter-fill {
            height: 20px;
            transition: width 0.3s;
        }
        .child-mood .meter-fill {
            background-color: #ff9900;
        }
        .parent-patience .meter-fill {
            background-color: #3399ff;
        }
        .time-left .meter-fill {
            background-color: #66cc66;
        }
        .scene-image {
            width: 50%; /* PC表示では幅を50%に制限 */
            height: auto; /* 高さは自動計算 */
            margin: 0 auto 10px; /* 中央揃え */
            max-height: none; /* max-heightをnoneに設定 */
            aspect-ratio: 4 / 3 !important; /* 4:3比率（最優先） */
            background-color: #ffebf3;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            position: relative;
            overflow: hidden; /* 画像がはみ出ないように */
        }
        .scene-image img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 画像がフレームを埋めるように表示 */
            aspect-ratio: 4 / 3 !important; /* 画像自体にも4:3を設定 */
        }
        .scene-description {
            margin-bottom: 20px;
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            text-align: left;
        }
       .options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
    width: 100%;
}

.option-btn {
    padding: 10px 15px;
    background-color: #f0f0f0;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-align: left;
    transition: background-color 0.3s;
    width: 100%;
    display: block;
}
        .option-btn:hover {
            background-color: #e0e0e0;
        }
        .skill-option {
            background-color: #e6f7ff;
            border-left: 4px solid #1890ff;
        }
        .result {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            text-align: left;
        }
        .tip {
            background-color: #fffbe6;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .exp-gain {
            color: #52c41a;
            font-weight: bold;
        }
        .level-up {
            color: #ff4d4f;
            font-weight: bold;
            font-size: 1.2em;
            text-align: center;
            margin: 10px 0;
        }
        .skill-unlock {
            color: #1890ff;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        .next-btn, .next-day-btn {
            padding: 10px 20px;
            background-color: #1890ff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .restart-btn {
            padding: 10px 20px;
            background-color: #ff4d4f;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        .reward-btn {
            padding: 12px 30px;
            background-color: #ff6699;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin: 20px 0;
            font-size: 1.2em;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .reward-btn:hover {
            background-color: #ff8eb2;
            transform: scale(1.05);
        }
        .test-btn {
            padding: 8px 20px;
            background-color: #9966cc;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .test-btn:hover {
            background-color: #aa77dd;
            transform: scale(1.05);
        }
        .game-over {
            color: #ff4d4f;
            font-weight: bold;
            font-size: 1.5em;
            text-align: center;
            margin: 20px 0;
        }
        .game-clear {
            color: #52c41a;
            font-weight: bold;
            font-size: 1.5em;
            text-align: center;
            margin: 20px 0;
        }
        .day-info {
            background-color: #f0f8ff;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        .weekday {
            color: #1890ff;
            font-size: 0.9em;
        }
        .weekend {
            color: #ff4d4f;
            font-size: 0.9em;
        }
        /* 動画コンテナのスタイル */
        .video-container {
            width: 100%;
            text-align: center;
            margin: 20px 0;
        }
        
        #clear-video {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        /* 既存のスタイルに追加するレスポンシブデザイン用のCSS */
@media screen and (max-width: 768px) {
    body {
        padding: 10px;
        font-size: 16px;
    }
    
    #title-screen h1 {
        font-size: 1.8em;
        margin-bottom: 20px;
    }
    
    .title-image {
        max-width: 400px;
        margin-bottom: 20px;
        aspect-ratio: 4 / 3; /* 4:3比率に変更 */
    }
    
    .start-btn {
        padding: 12px 40px;
        font-size: 1.3em;
    }
    
    .game-container {
        padding: 10px;
    }
    
 /* ステータスバーを横並びに戻す */
    .status-bar {
        flex-direction: row; /* 横並びに変更 */
        gap: 5px;
        margin-bottom: 10px;
    }
    
    .meter {
        width: 32%; /* 3つ並べるためにわずかに調整 */
    }
    
    .meter p {
        font-size: 0.8em; /* フォントサイズを小さく */
        margin: 0 0 2px 0; /* マージンを減らす */
    }
    
    .meter-fill {
        height: 12px; /* メーターの高さを小さく */
    }
    
     /* シーン画像を小さく */
     .scene-image {
        width: 80%; /* タブレット表示では幅を80%に */
        height: auto; /* 高さは自動計算 */
        margin: 0 auto 10px; /* 中央揃え */
        max-height: none; /* max-heightをnoneに設定 */
        aspect-ratio: 4 / 3 !important; /* 4:3比率（最優先） */
    }
    
    /* 画像のサイズ調整 */
    .scene-image img {
        width: 100%;
        height: 100%;
        max-height: none; /* max-heightをnoneに設定 */
        object-fit: cover; /* coverに変更 */
        aspect-ratio: 4 / 3 !important; /* 画像自体にも4:3を設定 */
    }
    
    /* 説明文をコンパクトに */
    .scene-description {
        padding: 10px;
        margin-bottom: 10px;
        font-size: 0.9em;
    }
    
    /* 選択肢ボタンをコンパクトに */
    .option-btn {
        padding: 8px 10px;
        font-size: 0.9em;
    }
    
    /* 全体の余白を調整 */
    .game-container {
        padding: 10px;
    }
    
    /* 日付表示をコンパクトに */
    .day-info {
        padding: 3px 10px;
        font-size: 0.9em;
    }
    
    /* 動画サイズをモバイル向けに調整 */
    #clear-video {
        max-width: 100%;
        max-height: 200px;
    }
    
    /* ご褒美ボタンをモバイル向けに調整 */
    .reward-btn {
        padding: 10px 20px;
        font-size: 1em;
    }
    
    .rules-container {
        padding: 15px;
    }
    
    .rules-content {
        font-size: 0.95em;
    }
}

/* さらに小さい画面用 */
@media screen and (max-width: 480px) {
    #title-screen h1 {
        font-size: 1.5em;
    }
    
    .title-image {
        max-width: 300px;
        aspect-ratio: 4 / 3; /* 4:3比率に変更 */
    }
    
    .meter p {
        font-size: 0.7em; /* さらに小さく */
    }
    
    .scene-image {
        height: auto; /* 高さは自動計算 */
        max-height: none; /* max-heightをnoneに設定 */
        aspect-ratio: 4 / 3 !important; /* 4:3比率（最優先） */
    }

    .scene-image img {
        width: 100%;
        height: 100%;
        max-height: none; /* max-heightをnoneに設定 */
        object-fit: cover; /* coverに変更 */
        aspect-ratio: 4 / 3 !important; /* 画像自体にも4:3を設定 */
    }
}
    </style>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<body>
    <div id="title-screen" class="screen">
        <h1>イヤイヤ期子育て<br>シミュレーションゲーム<br>〜りーちゃん編〜</h1>
        <div class="title-image">
            <img src="images/title.jpg" alt="りーちゃんの画像">
        </div>
        <button id="start-btn" class="start-btn">START</button>
        <!-- テストボタンを非表示に -->
        <div style="margin-top: 30px; display: none;">
            <button id="test-video-btn" class="test-btn">動画テスト</button>
        </div>
    </div>
    
    <div id="rules-screen" class="screen" style="display: none;">
        <div class="rules-container">
            <h2>あそびかた</h2>
            <div class="rules-content">
                <p><span class="ree-chan">あおきりあ</span>です！3さいです！</p>
                <p>りあはさー、ときどき「イヤイヤ」しちゃうんだよね。</p>
                <p>だってさー、じぶんでやりたいことがあるんだよね。</p>
                <p>おかあさんは、りあのきもちをわかってくれるとうれしいんだけどな♡</p>
                <p>このゲームはさー、<span class="highlight">りあのきもち</span>と<span class="highlight">おかあさんのがまんづよさ</span>と<span class="highlight">のこりじかん</span>があるよ！</p>
                <p>げつようびからにちようびまでの1しゅうかん、りあといっぱい、いっぱい、いーーっぱい、あそんでね！</p>
                <p>りあのきもちがゼロになったり、おかあさんのがまんがなくなったり、じかんがなくなると、ゲームオーバーだからね！</p>
                <p>にちようびまでたどりついてね。いっしょにあそぼうね！</p>
            </div>
            <button id="rules-ok-btn" class="rules-ok-btn">OK！</button>
        </div>
    </div>
    
    <div id="game-screen" class="screen" style="display: none;">
        <div class="game-container">
            <div class="header">
                <div class="day-info">
                    <p><span id="day">1</span>日目 (<span id="weekday" class="weekday">月曜日</span>)</p>
                </div>
            </div>
            
            <div class="status-bar">
                <div class="meter child-mood">
                    <p>りーちゃんの機嫌</p>
                    <div id="childMoodMeter" class="meter-fill" style="width: 50%;"></div>
                </div>
                <div class="meter parent-patience">
                    <p>おかあさんの忍耐力</p>
                    <div id="parentPatienceMeter" class="meter-fill" style="width: 100%;"></div>
                </div>
                <div class="meter time-left">
                    <p>残り時間</p>
                    <div id="timeLeftMeter" class="meter-fill" style="width: 100%;"></div>
                </div>
            </div>
            
            <div class="scene-image">
                <p>りーちゃん（3歳）</p>
            </div>
            
            <div id="sceneDescription" class="scene-description"></div>
            
            <div id="options" class="options"></div>
            
            <div id="result" class="result"></div>
        </div>
    </div>

    <script>
        // ゲームの状態
        const gameState = {
            childMood: 50,
            parentPatience: 100,
            timeLeft: 100,
            day: 1,
            currentEvent: 0, // 0: 朝, 1: 昼/夕方, 2: 夜
            extraEventPlayed: false, // エクストライベントが発生したかどうか
            playedExtraEvents: [], // 発動済みのエクストライベントのインデックスを記録
            
            // 曜日の取得
            getWeekday() {
                const weekdays = ["月曜日", "火曜日", "水曜日", "木曜日", "金曜日", "土曜日", "日曜日"];
                return weekdays[this.day - 1];
            },
            
            // 平日かどうか
            isWeekday() {
                return this.day <= 5; // 1-5日目は平日
            },
            
            // 朝イベント（平日・休日共通）
            morningEvents: [
                {
                    description: "朝の着替えの時間です。りーちゃんは「自分でやる！」と言いながらも、なかなか着替えが進みません。",
                    image: "images/morning_clothes.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「早くしなさい！もう時間がないよ」と急かす", 
                            result: "りーちゃんは不機嫌になり、さらに着替えるのを拒否してしまいました。時間もかかってしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「おかあさんが手伝おうか？」と提案する", 
                            result: "りーちゃんは「自分でやる！」と言いながらも少し手伝ってもらい、何とか着替えることができました。", 
                            childMood: -5, parentPatience: -30, timeLeft: -20
                        },
                        { 
                            text: "「すごいね、自分でボタンとめられるようになったね」と褒める", 
                            result: "りーちゃんは褒められて嬉しそうに、頑張って自分で着替えました。少し時間はかかりましたが、機嫌よく準備できました。", 
                            childMood: +10, parentPatience: -5, timeLeft: -30
                        },
                        { 
                            text: "「りーちゃんのお洋服、とっても可愛いね。着るの楽しみだね」と着替えに興味を持たせる", 
                            result: "りーちゃんは洋服に興味を示し、「見せてあげる！」と言って意欲的に着替え始めました。スムーズに着替えが完了しました。", 
                            childMood: +15, parentPatience: +0, timeLeft: -10
                        }
                    ]
                },
                {
                    description: "朝食の時間です。りーちゃんは「これ食べたくない」と言って、朝食を食べようとしません。",
                    image: "images/breakfast.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「食べなさい！」と強く言う", 
                            result: "りーちゃんは泣き出して、さらに食べるのを拒否してしまいました。朝から大変な雰囲気になってしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「じゃあ、何が食べたい？」と聞く", 
                            result: "りーちゃんは「りんごが食べたい！」と言いました。りんごを少し追加したら、他のおかずも少し食べてくれました。", 
                            childMood: +5, parentPatience: -10, timeLeft: -30
                        },
                        { 
                            text: "「このおかず、恐竜さんが食べるとすごく強くなれるんだって」と物語を作る", 
                            result: "りーちゃんは、「りーちゃんは恐竜じゃないからなー」と言って、呆れた様子で食べ始めました。", 
                            childMood: -15, parentPatience: -30, timeLeft: -10
                        },
                        { 
                            text: "「一口だけでも食べてみる？おいしいよ」と優しく促す", 
                            result: "りーちゃんは渋々一口食べてみると、「意外とおいしい」と言って少しずつ食べ始めました。時間はかかりましたが、半分は食べてくれました。", 
                            childMood: 0, parentPatience: -5, timeLeft: -30
                        }
                    ]
                },
                {
                    description: "出発の準備をしています。りーちゃんはまだ遊びたいと言って、なかなか準備ができません。",
                    image: "images/departure.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「もう行くよ！早くしなさい」と強く言う", 
                            result: "りーちゃんは泣き出して床に寝転がり、さらに準備が遅れてしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「あと5分だけ遊んでいいよ。そしたら出発しようね」と時間を区切る", 
                            result: "りーちゃんは「やった！」と喜び、5分後には「約束だもんね」と言って素直に準備を始めました。", 
                            childMood: +10, parentPatience: +0, timeLeft: -30
                        },
                        { 
                            text: "「今から出かけるよ。帰ってきたら続きで遊ぼうね」と次の楽しみを約束する", 
                            result: "りーちゃんは「今遊びたいの！」と言って怒り出し、なかなか準備をしてくれませんでした。", 
                            childMood: -20, parentPatience: -30, timeLeft: -50
                        },
                        { 
                            text: "「りーちゃんは電車の運転手さん、おかあさんは乗客ね。保育園駅まで連れて行ってください！」と遊びに変える", 
                            result: "りーちゃんは運転手さんになりきって喜び、「発車しまーす！」と言いながら元気に出かけました。とても効果的でした！", 
                            childMood: +20, parentPatience: +0, timeLeft: -5
                        }
                    ]
                }
            ],
            
            // 平日夕方イベント
            eveningEvents: [
                {
                    description: "保育園のお迎えの時間です。りーちゃんは「まだ遊びたい！」と言って、帰る準備をしません。",
                    image: "images/picking_up.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「もう帰るよ！早くしなさい」と強く言う", 
                            result: "りーちゃんは泣き出して、「イヤだ、帰らない！」とさらに強く拒否してしまいました。先生に助けてもらいましたが、時間がかかりました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「あと5分だけ遊んでいいよ。そしたら帰ろうね」と時間を区切る", 
                            result: "りーちゃんは「やった！」と喜んで遊び始めた、、、ところが5分後、まだ遊び足りないとグズってしまった、、、。", 
                            childMood: -10, parentPatience: -30, timeLeft: -40
                        },
                        { 
                            text: "「今日はどんなことして遊んだの？」と保育園での出来事を聞く", 
                            result: "りーちゃんは嬉しそうに今日の出来事を話し始め、話しながら自然と帰る準備ができました。", 
                            childMood: +10, parentPatience: +0, timeLeft: -10
                        },
                        { 
                            text: "「おうちに帰ったら、りーちゃんの好きなおやつがあるよ」と楽しみを伝える", 
                            result: "りーちゃんは「今食べたい！」となり、帰らないと食べられないことに対して怒り出した、、、。", 
                            childMood: -10, parentPatience: -20, timeLeft: -30
                        }
                    ]
                },
                {
                    description: "家に帰ってきました。りーちゃんは手を洗わずにおもちゃで遊び始めようとしています。",
                    image: "images/hand_washing.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「手を洗いなさい！」と強く言う", 
                            result: "りーちゃんは不機嫌になり、「イヤだ！」と言って手を洗うのを拒否してしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「手を洗ったら、一緒におもちゃで遊ぼうね」と条件を出す", 
                            result: "りーちゃんは少し考えて、「約束だよ？」と言いながら手を洗いに行きました。", 
                            childMood: +5, parentPatience: -5, timeLeft: -10
                        },
                        { 
                            text: "「手洗いレースしよう！誰が一番早く上手に洗えるかな？」と遊びに変える", 
                            result: "りーちゃんは「りーちゃんが勝つ！」と言って喜んで手を洗いに行きました。楽しく手洗いができました。", 
                            childMood: +10, parentPatience: +0, timeLeft: -5
                        },
                        { 
                            text: "「手を洗うと、おもちゃの菌をやっつけられるよ。おもちゃも喜ぶね」と理由を伝える", 
                            result: "りーちゃんは「バイキンマンいじめちゃダメ！」と言って、怒り出した、、、。", 
                            childMood: -10, parentPatience: -20, timeLeft: -30
                        }
                    ]
                },
                {
                    description: "夕食の時間です。りーちゃんは「これ嫌い！」と言って、おみそ汁を食べようとしません。",
                    image: "images/dinner.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「食べな。残したらデザートなしだよ」と強めに言う", 
                            result: "りーちゃんは「しかたないですね」と言って渋々食べてくれた。", 
                            childMood: -10, parentPatience: -5, timeLeft: -5
                        },
                        { 
                            text: "「一口だけでも食べてみる？」と優しく促す", 
                            result: "りーちゃんは渋々一口食べてみると、「まあまあかな」と言って少しずつ食べ始めました。時間はかかりましたが、半分は食べてくれました。", 
                            childMood: -10, parentPatience: -10, timeLeft: -30
                        },
                        { 
                            text: "「おみそ汁、誰に運んでもらう？」と聞いてみる", 
                            result: "りーちゃんは、「ばあば！」と答えたので、「ばあば！ばあば！」と言って、スプーンでおみそ汁を口まで運んで上げると大喜びで食べてくれました。", 
                            childMood: +10, parentPatience: +0, timeLeft: -30
                        },
                        { 
                            text: "「おみそ汁を飲むと強くなれるよ。おかあさんも食べて強くなったんだよ」と伝える", 
                            result: "りーちゃんは「んなわけ！」とツッコミを入れて、大人たちの都合のいい嘘を見破りました。", 
                            childMood: -5, parentPatience: -20, timeLeft: -10
                        }
                    ]
                }
            ],
            
            // 休日昼イベント
            noonEvents: [
                {
                    description: "公園に来ました。りーちゃんは他の子のおもちゃを取ってしまい、トラブルになっています。",
                    image: "images/park.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「おともだちのものを取ったらダメでしょ！謝りなさい」と強く言う", 
                            result: "りーちゃんは泣き出して、謝るどころか「イヤだ！」と言って拒否してしまいました。状況が悪化してしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「貸してって言えたらいいね。一緒に言ってみる？」と提案する", 
                            result: "りーちゃんは少し考えて、一緒に「貸して」と言うことができました。相手の子も少し貸してくれて、仲直りできました。", 
                            childMood: +5, parentPatience: 0, timeLeft: -15
                        },
                        { 
                            text: "「おもちゃ、欲しかったんだね。でも、お友達も遊びたいんだよ」と気持ちに共感しつつ説明する", 
                            result: "りーちゃんは「でも、りーちゃんも遊びたいの！」と言って泣き出してしまいました、、、。", 
                            childMood: -10, parentPatience: -20, timeLeft: -30
                        },
                        { 
                            text: "「こっちにも面白いおもちゃがあるよ。一緒に遊ぼう」と別の遊びに誘う", 
                            result: "りーちゃんは新しいおもちゃに興味を示し、トラブルを忘れて楽しく遊び始めました。上手に気をそらすことができました。", 
                            childMood: +10, parentPatience: +0, timeLeft: -5
                        }
                    ]
                },
                {
                    description: "ファミレスでランチです。りーちゃんは席に座らず、店内を走り回ろうとしています。",
                    image: "images/family_restaurant.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「座って！走ったら危ないでしょ」と強めに言う", 
                            result: "りーちゃんは渋々座ってくれました。", 
                            childMood: -15, parentPatience: -5, timeLeft: -5
                        },
                        { 
                            text: "「ワオっちしようか？」とスマホを見せて誘う", 
                            result: "りーちゃんはワオっちに興味を示し、席に戻って遊び始めました。食事が来るまで静かに過ごすことができました。", 
                            childMood: +10, parentPatience: +0, timeLeft: -5
                        },
                        { 
                            text: "「お店の人や他のお客さんが困っちゃうよ。お食事が来るまでおかあさんとお話ししよう」と理由を説明する", 
                            result: "りーちゃんは少し考えて、「ワオっちがしたい！」と言い出しました。ワオっちはさせたくなかったので、引き続き交渉が続きました、、、。", 
                            childMood: -5, parentPatience: -30, timeLeft: -30
                        },
                        { 
                            text: "「どんなご飯が来るかな？メニューの写真を見てみよう」と興味を引く", 
                            result: "りーちゃんは「うどんがいい！」と言ったものの、うどんが無いことに気づき泣き出しました。結局何も食べないと言い出し、やむなくファミレスを出ることに、、、", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        }
                    ]
                },
                {
                    description: "スーパーでお買い物中です。りーちゃんはお菓子売り場で「これ買って！」とダダをこね始めました。",
                    image: "images/supermarket.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「今日は買わないよ」と拒否する", 
                            result: "りーちゃんは大泣きして床に寝転がり、周りのお客さんが見ている中で大変な状況になってしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「今日はこれを買う日じゃないんだよ。また今度ね」と優しく説明する", 
                            result: "りーちゃんは不満そうにしながら、「じゃあ、これ買って」と交渉を持ちかけてきました。ここで断ったらマズイだろうと思い、やむなく交渉成立となりました。", 
                            childMood: +0, parentPatience: -30, timeLeft: -10
                        },
                        { 
                            text: "「今日のおやつはもう決まってるよ。家に帰ったら食べようね」と別の楽しみを伝える", 
                            result: "りーちゃんは家のおやつに興味を示し、「何があるの？」と聞いてきました。お菓子への執着が薄れ、スムーズに買い物を続けられました。", 
                            childMood: +5, parentPatience: +0, timeLeft: -5
                        },
                        { 
                            text: "「お買い物リストのものを探すの手伝ってくれる？りーちゃんにお手伝いしてほしいな」と役割を与える", 
                            result: "りーちゃんは「りーちゃんがお手伝いする！」と言って、お菓子のことを忘れて買い物を手伝い始めましたが、かえって買い物に時間がかかりました、、、。", 
                            childMood: +10, parentPatience: +0, timeLeft: -40
                        }
                    ]
                }
            ],
            
            // 夜イベント（平日・休日共通）
            nightEvents: [
                {
                    description: "お風呂の時間です。りーちゃんは「お風呂入りたくない！」と言って逃げ回っています。",
                    image: "images/bath_time.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「早く入りなさい！」と言う", 
                            result: "りーちゃんはさらに抵抗し、大泣きして床に寝転がってしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「お風呂でジュース屋さんしようか？」と誘う", 
                            result: "りーちゃんは「ジュース屋さんはもう飽きたんだけどな」と言い、渋々ながらもお風呂に向かいました。", 
                            childMood: -10, parentPatience: -10, timeLeft: -5
                        },
                        { 
                            text: "「どうしてお風呂嫌なの？」と理由を聞く", 
                            result: "りーちゃんは「だってさー、洗いたくないんだよね」とめんどくさそうに答えました。本質的な理由まで聞き出せず、相変わらず対応しづらかった、、、。", 
                            childMood: -10, parentPatience: -30, timeLeft: -30
                        },
                        { 
                            text: "「お風呂入ったら、マンゴーはちみつ飲もうね」と条件を出す", 
                            result: "りーちゃんは「迷路したい」と言い出し、しかたなく2分迷路をしてからお風呂に向かいました。", 
                            childMood: +10, parentPatience: -20, timeLeft: -30
                        }
                    ]
                },
                {
                    description: "歯磨きの時間です。りーちゃんは「イヤだ！」と口を閉じて歯磨きを拒否しています。",
                    image: "images/dentifrice.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「歯磨きしないと虫歯になるよ！」と脅す", 
                            result: "りーちゃんはさらに怖がって拒否し、泣き出してしまいました。歯磨きどころではなくなってしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「歯磨きごっこしよう。まずはぬいぐるみの歯を磨いてあげよう」と遊びに変える", 
                            result: "りーちゃんはぬいぐるみの歯磨きに興味を示し、「次はりーちゃんの番！」と言って自分の歯も磨かせてくれました。", 
                            childMood: +10, parentPatience: -5, timeLeft: -15
                        },
                        { 
                            text: "「どっちの歯ブラシ使う？ウサギさんとクマさんどっちがいい？」と選択肢を与える", 
                            result: "りーちゃんは「ライオン！」と第三の選択肢を提示してきましたが、ライオンは無いと知ると怒りはじめました、、、。", 
                            childMood: -20, parentPatience: -30, timeLeft: -40
                        },
                        { 
                            text: "「歯磨きの歌を歌いながらやってみようか？」と楽しい雰囲気を作る", 
                            result: "りーちゃんは「歌ってたら歯磨けないじゃん」と冷静に答え、呆れた様子で静かに一人で磨き始めました。", 
                            childMood: -15, parentPatience: -30, timeLeft: -5
                        }
                    ]
                },
                {
                    description: "寝る時間です。りーちゃんは「まだ遊びたい！寝たくない！」と言って布団に入ろうとしません。",
                    image: "images/sleep.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「もう寝なさい！明日早いんだから」と強く言う", 
                            result: "りーちゃんは「あっち行って！」と言って泣き出し、さらに興奮してしまい、かえって寝付きが悪くなってしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「明日起きたら、また遊べるよ」と安心させる", 
                            result: "りーちゃんは「今遊びたいの！」と言ってエスカレートしてしまいました、、、。", 
                            childMood: -30, parentPatience: -30, timeLeft: -30
                        },
                        { 
                            text: "「今日一日、何が楽しかった？」と一日の振り返りをする", 
                            result: "りーちゃんは今日の楽しかったことを話し始め、話しているうちに自然と布団に入りました。穏やかな気持ちで眠りにつけました。", 
                            childMood: +10, parentPatience: +0, timeLeft: -20
                        },
                        { 
                            text: "「お話読んであげるね。どのお話がいい？」と絵本の読み聞かせを提案する", 
                            result: "りーちゃんは絵本に興味を示し、「これがいい！」と選んで布団に入りましたが、選んだ本が多く、寝るまでに時間がかかりました。", 
                            childMood: +15, parentPatience: -10, timeLeft: -40
                        }
                    ]
                }
            ],
            
            // エクストライベント（土日のみ）
            extraEvents: [
                {
                    description: "弟の「あっくん」とおもちゃを取り合い、あっくんが泣き出してしまいました。",
                    image: "images/akkun.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「りーちゃん、あっくんから取ったの？ダメでしょ！」と叱る", 
                            result: "りーちゃんは「りーちゃんが先に遊んでたの！」と言い返し、さらに言い争いになってしまいました。あっくんも泣き止まず、大変な状況になりました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「交代で遊ぼうね。まずはあっくんの番、次はりーちゃんの番だよ」と順番を決める", 
                            result: "りーちゃんは少し不満そうですが、「りーちゃんの番も来るんだよね？」と確認して、何とか納得してくれました。あっくんも泣き止みました。", 
                            childMood: -5, parentPatience: -10, timeLeft: -15
                        },
                        { 
                            text: "「りーちゃんはお姉ちゃんだから、あっくんに貸してあげられるかな？優しいお姉ちゃんだね」と年上としての誇りを持たせる", 
                            result: "りーちゃんは「りーちゃんは今あかちゃんなの！」と言って大人の想像を超える理屈で対抗してきました。", 
                            childMood: -10, parentPatience: -30, timeLeft: -30
                        },
                        { 
                            text: "「二人で一緒に遊べるおもちゃもあるよ。これで一緒に遊んでみる？」と別のおもちゃを提案する", 
                            result: "りーちゃんは「一人で遊びたいの！」と言って怒り出しました、、、。", 
                            childMood: -10, parentPatience: -30, timeLeft: -30
                        }
                    ]
                },
                {
                    description: "電車の時刻が迫っている中、りーちゃんが「歩きたくない、抱っこして」と言い出しました。",
                    image: "images/train.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「もう！急いでるのに！早く歩きなさい」と強く言う", 
                            result: "りーちゃんは泣き出して地面に座り込み、さらに動かなくなってしまいました。電車に間に合いませんでした。", 
                            childMood: -50, parentPatience: -50, timeLeft: -90
                        },
                        { 
                            text: "「疲れちゃったんだね。少しだけ抱っこするよ」と妥協する", 
                            result: "りーちゃんは抱っこしてもらって満足しました。何とか電車に間に合いそうです。", 
                            childMood: +10, parentPatience: -15, timeLeft: -15
                        },
                        { 
                            text: "「電車ごっこしながら行こう！りーちゃんが先頭車両ね」と遊びに変える", 
                            result: "りーちゃんは「しゅっぽーしゅっぽー！」と言いながら喜んで歩き始めました。ところが時間が結構かかり、電車に乗り遅れました、、、。", 
                            childMood: +15, parentPatience: -10, timeLeft: -50
                        },
                        { 
                            text: "「あの電車に乗れるかな？りーちゃんは走るの速いもんね」と挑戦心をくすぐる", 
                            result: "りーちゃんは「走ったら危ないんだよ！」と逆に諭され、反省しました。歩いてくれたので電車には間に合いました", 
                            childMood: -10, parentPatience: -50, timeLeft: -5
                        }
                    ]
                },
                {
                    description: "すでにジュースは飲んだのですが、りーちゃんが「もっとジュース飲みたい！」とぐずり始めました。",
                    image: "images/juice.jpg", // 画像パスを追加
                    options: [
                        { 
                            text: "「さっき飲んだから、おーしーまい！」と笑顔で伝える", 
                            result: "りーちゃんは大泣きして床に寝転がり、周りの人が見ている中で大変な状況になってしまいました。", 
                            childMood: -50, parentPatience: -50, timeLeft: -50
                        },
                        { 
                            text: "「お水ならいいよ。お水も美味しいよ」と代替案を提示する", 
                            result: "りーちゃんは「お水はイヤだ！」と言って、グズり始めました、、、。", 
                            childMood: -30, parentPatience: -30, timeLeft: -30
                        },
                        { 
                            text: "「ジュースはお腹いっぱいになっちゃうよ。また明日飲もうね」と理由と見通しを伝える", 
                            result: "りーちゃんは少し考えて、「明日は何のジュース？」と聞いてきました。明日の楽しみができて納得してくれました。", 
                            childMood: +5, parentPatience: 0, timeLeft: -15
                        },
                        { 
                            text: "「ジュースのかわりに、この後公園で遊ぼうか？」と別の楽しみを提案する", 
                            result: "りーちゃんは公園に興味を示し、「ブランコする！」と言ってジュースのことを忘れました。ところが、公園にブランコがなく不機嫌になりました、、、。", 
                            childMood: -30, parentPatience: -10, timeLeft: -5
                        }
                    ]
                }
            ]
        };
        
        // 現在のイベントを取得する関数
        function getCurrentEvent() {
            // 平日か休日かで分岐
            if (gameState.isWeekday()) {
                // 平日
                switch (gameState.currentEvent) {
                    case 0: // 朝
                        return getRandomEvent(gameState.morningEvents);
                    case 1: // 夕方
                        return getRandomEvent(gameState.eveningEvents);
                    case 2: // 夜
                        return getRandomEvent(gameState.nightEvents);
                    default:
                        console.warn('平日: 未定義のcurrentEvent値:', gameState.currentEvent);
                        return getRandomEvent(gameState.morningEvents); // デフォルトは朝イベント
                }
            } else {
                // 休日
                switch (gameState.currentEvent) {
                    case 0: // 朝
                        return getRandomEvent(gameState.morningEvents);
                    case 1: // 昼
                        return getRandomEvent(gameState.noonEvents);
                    case 2: // 夜（エクストライベント前）
                        return getRandomEvent(gameState.nightEvents);
                    case 3: // 夜（エクストライベント後）
                        return getRandomEvent(gameState.nightEvents);
                    default:
                        console.warn('休日: 未定義のcurrentEvent値:', gameState.currentEvent);
                        return getRandomEvent(gameState.morningEvents); // デフォルトは朝イベント
                }
            }
        }
        
        // ランダムなイベントを取得する関数
        function getRandomEvent(eventArray) {
            const randomIndex = Math.floor(Math.random() * eventArray.length);
            return eventArray[randomIndex];
        }
        
        // エクストライベントを取得する関数
        function getExtraEvent() {
            // 土日のみ、かつまだ発生していない場合
            if (!gameState.isWeekday() && !gameState.extraEventPlayed) {
                // まだ発動していないエクストライベントのインデックスを取得
                const availableIndices = [];
                for (let i = 0; i < gameState.extraEvents.length; i++) {
                    if (!gameState.playedExtraEvents.includes(i)) {
                        availableIndices.push(i);
                    }
                }
                
                // 発動していないイベントがある場合
                if (availableIndices.length > 0) {
                    // ランダムに選択
                    const randomIndex = Math.floor(Math.random() * availableIndices.length);
                    const selectedIndex = availableIndices[randomIndex];
                    
                    // 発動済みとして記録
                    gameState.playedExtraEvents.push(selectedIndex);
                    
                    return gameState.extraEvents[selectedIndex];
                }
                
                // すべてのイベントが発動済みの場合は、制限を無視して完全にランダムに選択
                if (gameState.extraEvents.length > 0) {
                    const randomIndex = Math.floor(Math.random() * gameState.extraEvents.length);
                    return gameState.extraEvents[randomIndex];
                }
            }
            return null;
        }
        
        // メーターの更新
        function updateMeters() {
            document.getElementById('childMoodMeter').style.width = `${gameState.childMood}%`;
            document.getElementById('parentPatienceMeter').style.width = `${gameState.parentPatience}%`;
            document.getElementById('timeLeftMeter').style.width = `${gameState.timeLeft}%`;
            
            // 色の変更（残り少ないと赤くなる）
            if (gameState.childMood < 30) {
                document.getElementById('childMoodMeter').style.backgroundColor = '#ff4d4f';
            } else {
                document.getElementById('childMoodMeter').style.backgroundColor = '#ff9900';
            }
            
            if (gameState.parentPatience < 30) {
                document.getElementById('parentPatienceMeter').style.backgroundColor = '#ff4d4f';
            } else {
                document.getElementById('parentPatienceMeter').style.backgroundColor = '#3399ff';
            }
            
            if (gameState.timeLeft < 30) {
                document.getElementById('timeLeftMeter').style.backgroundColor = '#ff4d4f';
            } else {
                document.getElementById('timeLeftMeter').style.backgroundColor = '#66cc66';
            }
        }
        
        // 曜日表示の更新
        function updateWeekday() {
            const weekday = gameState.getWeekday();
            const weekdayElement = document.getElementById('weekday');
            weekdayElement.textContent = weekday;
            
            // 土日は赤色に
            if (gameState.day > 5) {
                weekdayElement.className = 'weekend';
            } else {
                weekdayElement.className = 'weekday';
            }
        }
        
// イベントの表示
function displayEvent(event) {
    // イベントの種類を判断
    let eventType = "不明";
    if (gameState.morningEvents.some(e => e.description === event.description)) {
        eventType = "朝";
    } else if (gameState.eveningEvents.some(e => e.description === event.description)) {
        eventType = "夕方";
    } else if (gameState.noonEvents.some(e => e.description === event.description)) {
        eventType = "昼";
    } else if (gameState.nightEvents.some(e => e.description === event.description)) {
        eventType = "夜";
    } else if (gameState.extraEvents.some(e => e.description === event.description)) {
        eventType = "エクストラ";
    }
    
    // デバッグ情報
    console.log(`イベント表示: タイプ=${eventType}, currentEvent=${gameState.currentEvent}, 平日?=${gameState.isWeekday()}, エクストラ済み?=${gameState.extraEventPlayed}, 曜日=${gameState.getWeekday()}`);
    
    // 前の結果表示をクリア
    const resultElement = document.getElementById('result');
    resultElement.innerHTML = '';
    
    const sceneDescription = document.getElementById('sceneDescription');
    const optionsContainer = document.getElementById('options');
    const sceneImageContainer = document.querySelector('.scene-image');
    
    // シーンイメージコンテナにアスペクト比を強制的に設定
    sceneImageContainer.style.aspectRatio = "4/3";
    
    // 説明文の設定
    sceneDescription.textContent = event.description;
    
   // 画像の設定
    sceneImageContainer.innerHTML = ''; // 既存の内容をクリア
    const img = document.createElement('img');
    
    if (event.image) {
    // 画像パスがある場合
    img.src = event.image;
    } else {
    // 画像がない場合はデフォルトの画像を表示
    img.src = 'images/default_ree_chan.png';
    }

img.alt = 'シーン画像';
img.style.maxWidth = '100%';
img.style.maxHeight = '100%';
img.style.aspectRatio = "4/3"; // 画像自体にもアスペクト比を設定
sceneImageContainer.appendChild(img);

    // 選択肢のクリア
    optionsContainer.innerHTML = '';
    
    // 選択肢と説明文が非表示になっていたら表示に戻す
    optionsContainer.style.display = 'block';
    sceneDescription.style.display = 'block';
    
    // 選択肢の設定
    event.options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'option-btn';
        button.textContent = option.text;
        
        button.addEventListener('click', () => {
            // すべての選択肢ボタンを無効化
            const allButtons = optionsContainer.querySelectorAll('.option-btn');
            allButtons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';  // 視覚的にも無効化されていることを示す
                btn.style.cursor = 'default';
            });
            
            // 結果の表示
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = '';
            
            const resultText = document.createElement('p');
            resultText.textContent = option.result;
            resultElement.appendChild(resultText);
            
            // パラメータの更新
            gameState.childMood = Math.max(0, Math.min(100, gameState.childMood + option.childMood));
            gameState.parentPatience = Math.max(0, Math.min(100, gameState.parentPatience + option.parentPatience));
            gameState.timeLeft = Math.max(0, Math.min(100, gameState.timeLeft + option.timeLeft));
            
            // メーターの更新
            updateMeters();
            
            // ゲームオーバー判定
            if (gameState.childMood <= 0 || gameState.parentPatience <= 0 || gameState.timeLeft <= 0) {
                gameOver();
                return;
            }
            
            // 次へボタン
            const nextButton = document.createElement('button');
            nextButton.className = 'next-btn';
            nextButton.textContent = '次へ';
            
            nextButton.addEventListener('click', () => {
                // イベントを進める
                gameState.currentEvent++;
                
                // 土日で、かつ昼イベント終了後（currentEvent === 1からcurrentEvent++で2になった）、かつエクストライベントがまだ発生していない場合
                if (!gameState.isWeekday() && gameState.currentEvent === 2 && !gameState.extraEventPlayed) {
                    // エクストライベントを発動
                    const extraEvent = getExtraEvent();
                    if (extraEvent) {
                        gameState.extraEventPlayed = true;
                        // currentEventは2のままにし、後でextraEvent表示後に増やさない
                        displayEvent(extraEvent);
                        return;
                    }
                }
                
                // 土日で、かつエクストライベントが発生した後の次へボタンクリック時
                if (!gameState.isWeekday() && gameState.extraEventPlayed && gameState.currentEvent === 2) {
                    // 夜イベントを表示（currentEventは既に2なので増やさない）
                    gameState.currentEvent = 3; // 夜イベント用の値に設定
                    displayEvent(getCurrentEvent());
                    return;
                }
                
                // 一日の終了判定（平日と休日で判定条件を分ける）
                if ((gameState.isWeekday() && gameState.currentEvent > 2) || 
                    (!gameState.isWeekday() && gameState.currentEvent > 3)) {
                    endDay();
                } else {
                    // 次のイベントを表示
                    displayEvent(getCurrentEvent());
                }
            });
            
            resultElement.appendChild(nextButton);
        });
        
        optionsContainer.appendChild(button);
    });
}
        
       // 一日の終了処理
function endDay() {
    // 日数を進める
    gameState.day++;
    
    // 7日目終了ならゲームクリア
    if (gameState.day > 7) {
        gameClear();
        return;
    }
    
    // パラメータの回復
    gameState.childMood = Math.min(100, gameState.childMood + 10);
    gameState.parentPatience = Math.min(100, gameState.parentPatience + 20);
    gameState.timeLeft = 100;
    
    // 日数表示の更新
    document.getElementById('day').textContent = gameState.day;
    
    // メーターの更新
    updateMeters();
    
    // 曜日表示の更新
    updateWeekday();
    
    // 次の日の準備
    gameState.currentEvent = 0;
    gameState.extraEventPlayed = false;
    
    // 選択肢を非表示にする
    document.getElementById('options').style.display = 'none';
    // シーン説明を非表示にする
    document.getElementById('sceneDescription').style.display = 'none';
    
    // 結果表示
    const resultElement = document.getElementById('result');
    resultElement.innerHTML = '';
    
    const dayEndText = document.createElement('p');
    dayEndText.textContent = `${gameState.day - 1}日目が終わりました。次は${gameState.getWeekday()}です。`;
    resultElement.appendChild(dayEndText);
    
    // 次の日へボタン
    const nextDayButton = document.createElement('button');
    nextDayButton.className = 'next-day-btn';
    nextDayButton.textContent = '次の日へ';
    nextDayButton.addEventListener('click', () => {
        // 選択肢と説明文が非表示になっていたら表示に戻す
        if (document.getElementById('options').style.display === 'none') {
            document.getElementById('options').style.display = 'block';
        }
        if (document.getElementById('sceneDescription').style.display === 'none') {
            document.getElementById('sceneDescription').style.display = 'block';
        }
        
        displayEvent(getCurrentEvent());
    });
    resultElement.appendChild(nextDayButton);
}
        
        // ゲームオーバー処理
        function gameOver() {
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = '';
            
            const gameOverText = document.createElement('p');
            gameOverText.className = 'game-over';
            gameOverText.textContent = 'ゲームオーバー';
            resultElement.appendChild(gameOverText);
            
            let reasonText = '';
            if (gameState.childMood <= 0) {
                reasonText = 'りーちゃんの機嫌が最悪になってしまいました。大泣きが止まりません...';
            } else if (gameState.parentPatience <= 0) {
                reasonText = 'おかあさんの忍耐力が限界に達してしまいました。少し休憩が必要かもしれません...';
            } else if (gameState.timeLeft <= 0) {
                reasonText = '時間切れです。予定に大幅に遅れてしまいました...';
            }
            
            const reason = document.createElement('p');
            reason.textContent = reasonText;
            resultElement.appendChild(reason);
            
            const dayText = document.createElement('p');
            dayText.textContent = `${gameState.day}日目（${gameState.getWeekday()}）までがんばりました！`;
            resultElement.appendChild(dayText);
            
            // リスタートボタン
const restartButton = document.createElement('button');
restartButton.className = 'restart-btn';
restartButton.textContent = 'タイトルに戻る';
restartButton.addEventListener('click', resetGame);
resultElement.appendChild(restartButton);
}
        
        // ゲームクリア処理
        function gameClear() {
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = '';
            
            const gameClearText = document.createElement('p');
            gameClearText.className = 'game-clear';
            gameClearText.textContent = 'ゲームクリア！<br>おめでとうございます！';
            resultElement.appendChild(gameClearText);
            
            const clearMessage = document.createElement('p');
            clearMessage.textContent = '一週間、りーちゃんと楽しく過ごすことができました！';
            resultElement.appendChild(clearMessage);
            
            const reeChanMessage = document.createElement('p');
            reeChanMessage.style.color = '#ff6699';
            reeChanMessage.style.fontWeight = 'bold';
            reeChanMessage.style.fontSize = '1.2em';
            reeChanMessage.style.margin = '20px 0';
            reeChanMessage.textContent = 'りーちゃん「おかあさん、いつもありがとう。だいすきだよ♡」';
            resultElement.appendChild(reeChanMessage);
            
            // ご褒美動画を見るボタンを追加
            const rewardButton = document.createElement('button');
            rewardButton.className = 'reward-btn';
            rewardButton.textContent = 'ご褒美動画を見る';
            
            rewardButton.addEventListener('click', function() {
                // ボタンを非表示にする
                this.style.display = 'none';
                
                // 動画コンテナを作成
                const videoContainer = document.createElement('div');
                videoContainer.className = 'video-container';
                videoContainer.style.marginTop = '20px';
                
                // YouTube埋め込み動画を使用
                const youtubeContainer = document.createElement('div');
                youtubeContainer.style.position = 'relative';
                youtubeContainer.style.width = '100%';
                youtubeContainer.style.maxWidth = '640px';
                youtubeContainer.style.margin = '0 auto';
                youtubeContainer.style.borderRadius = '10px';
                youtubeContainer.style.overflow = 'hidden';
                youtubeContainer.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
                
                // YouTube動画IDを設定（ここを実際の動画IDに変更してください）
                const youtubeVideoId = 'EDMJpdC4dJc'; // 例: かわいい子供の動画に変更してください
                
                // iframeを作成
                const iframe = document.createElement('iframe');
                iframe.width = '100%';
                iframe.height = '360';
                iframe.src = `https://www.youtube.com/embed/${youtubeVideoId}?rel=0&autoplay=0&controls=1`;
                iframe.title = 'YouTube動画';
                iframe.frameBorder = '0';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                iframe.style.borderRadius = '10px';
                
                youtubeContainer.appendChild(iframe);
                videoContainer.appendChild(youtubeContainer);
                
                // 説明テキスト
                const description = document.createElement('p');
                description.textContent = 'りーちゃんからのご褒美動画です♪';
                description.style.marginTop = '15px';
                description.style.color = '#ff6699';
                description.style.fontWeight = 'bold';
                videoContainer.appendChild(description);
                
                // 動画コンテナを追加
                resultElement.appendChild(videoContainer);
                
                // 再生ボタン（明示的に再生を開始するため）
                const playButton = document.createElement('button');
                playButton.textContent = '動画を再生する';
                playButton.className = 'next-btn';
                playButton.style.marginTop = '10px';
                playButton.style.backgroundColor = '#ff6699';
                playButton.style.fontSize = '1.2em';
                playButton.style.padding = '12px 30px';
                
                playButton.addEventListener('click', function() {
                    // 自動再生付きのURLに更新
                    iframe.src = `https://www.youtube.com/embed/${youtubeVideoId}?rel=0&autoplay=1&controls=1`;
                    // ボタンを非表示
                    this.style.display = 'none';
                });
                
                videoContainer.appendChild(playButton);
            });
            
            resultElement.appendChild(rewardButton);
            
            // リスタートボタン
const restartButton = document.createElement('button');
restartButton.className = 'restart-btn';
restartButton.textContent = 'タイトルに戻る';
restartButton.addEventListener('click', resetGame);
resultElement.appendChild(restartButton);
}        
    // ゲームリセット
function resetGame() {
    gameState.childMood = 80;
    gameState.parentPatience = 100;
    gameState.timeLeft = 100;
    gameState.day = 1;
    gameState.currentEvent = 0;
    gameState.extraEventPlayed = false;
    gameState.playedExtraEvents = []; // 発動済みエクストライベントのリセット
    
    // 日数表示の更新
    document.getElementById('day').textContent = gameState.day;
    
    // メーターと曜日を更新
    updateMeters();
    updateWeekday();
    
    // タイトル画面に戻る
    showScreen('title-screen');
}
        
// 画面切り替え関数
function showScreen(screenId) {
    console.log('Showing screen:', screenId);
    
    // すべての画面を非表示
    document.querySelectorAll('.screen').forEach(screen => {
        console.log('Hiding screen:', screen.id);
        screen.style.display = 'none';
    });
    
    // 指定した画面を表示
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) {
        console.log('Displaying screen:', screenId);
        targetScreen.style.display = 'block';
    } else {
        console.error('Screen not found:', screenId);
    }
}

// DOMContentLoaded イベントを使用して、ページの読み込みが完了してから実行する
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded');
    
    // タイトル画面のSTARTボタン
    const startBtn = document.getElementById('start-btn');
    if (startBtn) {
        startBtn.addEventListener('click', function() {
            console.log('Start button clicked');
            showScreen('rules-screen');
        });
    } else {
        console.error('Start button not found');
    }
    
    // 動画テストボタン
    const testVideoBtn = document.getElementById('test-video-btn');
    if (testVideoBtn) {
        testVideoBtn.addEventListener('click', function() {
            console.log('Test video button clicked');
            showVideoTestScreen();
        });
    } else {
        console.error('Test video button not found');
    }
    
    // ルール画面のOKボタン
    const rulesOkBtn = document.getElementById('rules-ok-btn');
    if (rulesOkBtn) {
        rulesOkBtn.addEventListener('click', function() {
            console.log('Rules OK button clicked');
            showScreen('game-screen');
            // ゲーム初期化
            updateMeters();
            updateWeekday();
            displayEvent(getCurrentEvent());
        });
    } else {
        console.error('Rules OK button not found');
    }
    
    // 初期表示はタイトル画面
    showScreen('title-screen');
});

// 動画テスト画面を表示する関数
function showVideoTestScreen() {
    // 既存の画面を非表示
    document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
    });
    
    // 動画テスト画面を作成
    const videoTestScreen = document.createElement('div');
    videoTestScreen.id = 'video-test-screen';
    videoTestScreen.className = 'screen';
    videoTestScreen.style.display = 'block';
    
    // 画面のコンテンツを作成
    const container = document.createElement('div');
    container.className = 'rules-container';
    container.style.backgroundColor = 'white';
    container.style.padding = '30px';
    container.style.borderRadius = '10px';
    container.style.boxShadow = '0 0 10px rgba(0,0,0,0.1)';
    
    // タイトル
    const title = document.createElement('h2');
    title.textContent = '動画テスト';
    title.style.color = '#9966cc';
    title.style.marginBottom = '20px';
    container.appendChild(title);
    
    // 説明文
    const description = document.createElement('p');
    description.textContent = 'YouTube動画再生機能のテストです。下のボタンをクリックすると動画が表示されます。';
    description.style.marginBottom = '20px';
    container.appendChild(description);
    
    // YouTube埋め込み情報セクション
    const youtubeInfoSection = document.createElement('div');
    youtubeInfoSection.style.backgroundColor = '#f0f8ff';
    youtubeInfoSection.style.padding = '15px';
    youtubeInfoSection.style.borderRadius = '10px';
    youtubeInfoSection.style.marginBottom = '20px';
    youtubeInfoSection.innerHTML = `
        <h3 style="margin-top: 0; color: #1890ff;">YouTube埋め込み設定</h3>
        <p>現在設定されているYouTube動画ID: <code>EDMJpdC4dJc</code></p>
        <p>別の動画を使用する場合は、コードの <code>youtubeVideoId</code> を変更してください。</p>
        <p>YouTubeの動画URLが <code>https://www.youtube.com/watch?v=EDMJpdC4dJc</code> の場合、<br>
        動画IDは <code>EDMJpdC4dJc</code> の部分です。</p>
    `;
    container.appendChild(youtubeInfoSection);
    
    // 動画コンテナ
    const videoContainer = document.createElement('div');
    videoContainer.className = 'video-container';
    videoContainer.style.display = 'none'; // 最初は非表示
    container.appendChild(videoContainer);
    
    // 動画を表示ボタン
    const playButton = document.createElement('button');
    playButton.textContent = '動画を表示';
    playButton.className = 'next-btn';
    playButton.style.backgroundColor = '#9966cc';
    playButton.style.fontSize = '1.2em';
    playButton.style.padding = '12px 30px';
    
    playButton.addEventListener('click', function() {
        // ボタンを非表示
        this.style.display = 'none';
        
        // 動画コンテナを表示
        videoContainer.style.display = 'block';
        
        // YouTube埋め込み動画を使用
        const youtubeContainer = document.createElement('div');
        youtubeContainer.style.position = 'relative';
        youtubeContainer.style.width = '100%';
        youtubeContainer.style.maxWidth = '640px';
        youtubeContainer.style.margin = '0 auto';
        youtubeContainer.style.borderRadius = '10px';
        youtubeContainer.style.overflow = 'hidden';
        youtubeContainer.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        
        // YouTube動画IDを設定
        const youtubeVideoId = 'EDMJpdC4dJc'; // 例: かわいい子供の動画に変更してください
        
        // iframeを作成
        const iframe = document.createElement('iframe');
        iframe.width = '100%';
        iframe.height = '360';
        iframe.src = `https://www.youtube.com/embed/${youtubeVideoId}?rel=0&autoplay=0&controls=1`;
        iframe.title = 'YouTube動画';
        iframe.frameBorder = '0';
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
        iframe.allowFullscreen = true;
        iframe.style.borderRadius = '10px';
        
        youtubeContainer.appendChild(iframe);
        videoContainer.appendChild(youtubeContainer);
        
        // 説明テキスト
        const videoDescription = document.createElement('p');
        videoDescription.textContent = 'YouTube動画のテストです。';
        videoDescription.style.marginTop = '15px';
        videoDescription.style.color = '#9966cc';
        videoContainer.appendChild(videoDescription);
        
        // 再生ボタン（明示的に再生を開始するため）
        const videoPlayButton = document.createElement('button');
        videoPlayButton.textContent = '動画を再生する';
        videoPlayButton.className = 'next-btn';
        videoPlayButton.style.marginTop = '10px';
        videoPlayButton.style.backgroundColor = '#9966cc';
        videoPlayButton.style.fontSize = '1.2em';
        videoPlayButton.style.padding = '12px 30px';
        
        videoPlayButton.addEventListener('click', function() {
            // 自動再生付きのURLに更新
            iframe.src = `https://www.youtube.com/embed/${youtubeVideoId}?rel=0&autoplay=1&controls=1`;
            // ボタンを非表示
            this.style.display = 'none';
        });
        
        videoContainer.appendChild(videoPlayButton);
        
        // 接続テスト結果
        const connectionTest = document.createElement('div');
        connectionTest.style.marginTop = '20px';
        connectionTest.style.padding = '10px';
        connectionTest.style.backgroundColor = '#f6ffed';
        connectionTest.style.borderRadius = '5px';
        connectionTest.innerHTML = `
            <p style="margin: 0; color: #52c41a;"><strong>✅ YouTube接続テスト成功</strong></p>
            <p style="margin-top: 5px; font-size: 0.9em;">YouTubeの埋め込み動画が正常に読み込まれました。</p>
        `;
        videoContainer.appendChild(connectionTest);
    });
    
    container.appendChild(playButton);
    
    // 戻るボタン
    const backButton = document.createElement('button');
    backButton.textContent = 'タイトルに戻る';
    backButton.className = 'restart-btn';
    backButton.addEventListener('click', function() {
        // 動画テスト画面を削除
        videoTestScreen.remove();
        // タイトル画面を表示
        showScreen('title-screen');
    });
    backButton.style.marginTop = '20px';
    container.appendChild(backButton);
    
    videoTestScreen.appendChild(container);
    document.body.appendChild(videoTestScreen);
}

// デバッグ用：イベントリスナーの確認
console.log('Start button exists:', !!document.getElementById('start-btn'));
console.log('Rules OK button exists:', !!document.getElementById('rules-ok-btn'));

// 明示的にイベントリスナーを再設定

if (document.getElementById('rules-ok-btn')) {
    document.getElementById('rules-ok-btn').onclick = function() {
        console.log('Rules OK button clicked');
        showScreen('game-screen');
        updateMeters();
        updateWeekday();
        displayEvent(getCurrentEvent());
    };
}

// シーン画像のアスペクト比を強制的に修正する関数
function fixSceneImageAspectRatio() {
    console.log('シーン画像のアスペクト比を修正します');
    const sceneImages = document.querySelectorAll('.scene-image');
    
    // CSSのカスタムプロパティの値を確認
    const rootStyle = getComputedStyle(document.documentElement);
    const aspectRatioValue = rootStyle.getPropertyValue('--scene-aspect-ratio').trim() || "4/3";
    console.log('グローバルアスペクト比設定:', aspectRatioValue);
    
    // 画面幅に応じて適切な幅を設定
    let imageWidth = '50%'; // デフォルトはPC表示で50%
    if (window.innerWidth <= 768) {
        imageWidth = '80%'; // タブレット表示では80%
    }
    if (window.innerWidth <= 480) {
        imageWidth = '100%'; // スマホ表示では100%
    }
    
    sceneImages.forEach(container => {
        // 既存のインラインスタイルをリセット
        container.removeAttribute('style');
        
        // 新しいスタイルを設定
        container.style.aspectRatio = "4/3";
        container.style.width = imageWidth;
        container.style.margin = "0 auto 10px";
        container.style.height = "auto";
        // max-heightの設定を削除
        
        // スタイルの設定を確認
        const computedStyle = window.getComputedStyle(container);
        console.log('現在のアスペクト比:', computedStyle.aspectRatio);
        console.log('現在の幅:', computedStyle.width);
        
        // もし21:9が見つかったら警告
        if (computedStyle.aspectRatio.includes('21/9') || computedStyle.aspectRatio.includes('21 / 9')) {
            console.error('21:9のアスペクト比が検出されました！強制上書きします');
        }
        
        // containerの中の画像も修正
        const images = container.querySelectorAll('img');
        images.forEach(img => {
            // 既存のインラインスタイルをリセット
            img.removeAttribute('style');
            
            // 新しいスタイルを設定
            img.style.aspectRatio = "4/3";
            img.style.objectFit = "cover";
            img.style.width = "100%";
            img.style.height = "100%";
        });
    });
    
    // CSSルールを検索して21:9があれば警告
    for (let i = 0; i < document.styleSheets.length; i++) {
        try {
            const styleSheet = document.styleSheets[i];
            const rules = styleSheet.cssRules || styleSheet.rules;
            
            for (let j = 0; j < rules.length; j++) {
                const rule = rules[j];
                const cssText = rule.cssText || '';
                
                if (cssText.includes('21/9') || cssText.includes('21 / 9')) {
                    console.error('CSSに21:9の設定が見つかりました:', cssText);
                }
            }
        } catch (e) {
            // CSSのクロスオリジンの制限により読めないスタイルシートがある場合
            console.log('スタイルシートの検査中にエラー:', e);
        }
    }
    
    // 1秒後に再度実行
    setTimeout(fixSceneImageAspectRatio, 1000);
}

// DOMロード時に実行
document.addEventListener('DOMContentLoaded', function() {
    // 初期実行
    fixSceneImageAspectRatio();
});

// ページロード完了時にも実行
window.onload = function() {
    // 再実行
    fixSceneImageAspectRatio();
};
    </script>
</body>
</html>
